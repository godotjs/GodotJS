name: ğŸ“¨ Publish editor
on:
  workflow_call:

permissions:
  id-token: write  # Required for OIDC
  contents: write

jobs:
  publis-editor:
    runs-on: ubuntu-latest
    outputs:
      id: ${{ steps.publish_release.outputs.id }}
    steps:
      - name: â¬ Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ›« Setup pnpm
        uses: ./.github/actions/pnpm-setup

      - name: ğŸ”„ï¸ Install dependencies
        run: pnpm install

      - name: â¬ Download build
        uses: actions/download-artifact@v4
        with:
          name: editor-dist
          path: ${{github.workspace}}/scripts/editor/dist

      - name: ğŸ“ Update version for prerelease
        if: github.event.release.prerelease
        run: |
          cd ${{github.workspace}}/scripts/editor
          pnpm version ${{ github.event.release.tag_name }} --no-git-tag-version --allow-same-version

      - name: ğŸš¢ Publish release
        run: |
          cd ${{github.workspace}}/scripts/editor
          if [ "${{ github.event.release.prerelease }}" = "true" ]; then
            pnpm publish --tag next --no-git-checks
          else
            pnpm publish --no-git-checks
          fi
