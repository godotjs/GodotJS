name: ü¶Ö Upload Release Assets
on:
  workflow_call:
    inputs:
      version:
        required: true
        type: string

permissions:
  contents: write

jobs:
  upload-dektop:
    runs-on: ubuntu-latest
    name: ${{ matrix.os }}-${{ matrix.target }}-${{inputs.version}}-${{ matrix.engine }}
    strategy:
      fail-fast: false
      matrix:
        engine: [ v8, qjs-ng ]
        os: [ linux, macos, windows ]
        target: [ template_release, template_debug, editor ]
        include:
          - target: editor-app
            os: macos
            engine: v8
          - target: template-app
            os: macos
            engine: v8
    steps:
      - name: ‚è¨ Checkout repo
        uses: actions/checkout@v4

      - name: Upload builds
        uses: ./.github/actions/upload-asset
        with:
          os: ${{ matrix.os }}
          target: ${{ matrix.target }}
          engine: ${{ matrix.engine }}
          version: ${{ inputs.version }}
          release-id: ${{ github.event.release.id }}
          token: ${{ secrets.GITHUB_TOKEN }}

  upload-mobile:
    runs-on: ubuntu-latest
    name: ${{ matrix.os }}-${{ matrix.target }}-${{inputs.version}}-${{ matrix.engine }}
    strategy:
      fail-fast: false
      matrix:
        engine: [ v8, qjs-ng ]
        os: [ android, ios ]
        target: [ template_release, template_debug ]
    steps:
      - name: ‚è¨ Checkout repo
        uses: actions/checkout@v4

      - name: Upload builds
        uses: ./.github/actions/upload-asset
        with:
          os: ${{ matrix.os }}
          target: ${{ matrix.target }}
          engine: ${{ matrix.engine }}
          version: ${{ inputs.version }}
          release-id: ${{ github.event.release.id }}
          token: ${{ secrets.GITHUB_TOKEN }}

  upload-web:
    runs-on: ubuntu-latest
    name: ${{ matrix.os }}-${{ matrix.target }}-${{inputs.version}}-${{ matrix.engine }}
    strategy:
      fail-fast: false
      matrix:
        engine: [ browser, qjs-ng ]
        os: [ web, web-nothreads, web-dlink, web-dlink-nothreads ]
        target: [ template_release, template_debug ]
    steps:
      - name: ‚è¨ Checkout repo
        uses: actions/checkout@v4

      - name: Upload builds
        uses: ./.github/actions/upload-asset
        with:
          os: ${{ matrix.os }}
          target: ${{ matrix.target }}
          engine: ${{ matrix.engine }}
          version: ${{ inputs.version }}
          release-id: ${{ github.event.release.id }}
          token: ${{ secrets.GITHUB_TOKEN }}
